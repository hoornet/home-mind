# Home Mind

[![License: AGPL v3](https://img.shields.io/badge/License-AGPL%20v3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0)
[![Version](https://img.shields.io/badge/Version-0.9.0-brightgreen.svg)]()
[![Status](https://img.shields.io/badge/Status-Voice%20Working-success.svg)]()

AI assistant for Home Assistant with cognitive memory. Adds learning capabilities, persistent memory, and voice control to your smart home.

## The Problem

Current Home Assistant AI integrations suffer from:

- **No persistent memory** - Forgets corrections and preferences between sessions
- **No learning capability** - Can't remember sensor baselines or user preferences
- **Stateless interactions** - Every conversation starts from zero

## The Solution

Home Mind provides:

- **Cognitive memory** with semantic search and natural decay (via Shodh Memory)
- **Learning** from corrections and user preferences
- **Voice control** via HA Assist (Wyoming protocol)
- **Multi-LLM support** — Anthropic (Claude) or OpenAI, with more providers planned
- **Self-hosted** and privacy-focused

## Memory in Action

Unlike stateless AI assistants, Home Mind **learns and remembers** across conversations:

**First Conversation:**
```
User: What's the NOx sensor reading?
AI: The NOx sensor shows 100 ppm.

User: Is that high?
AI: Typically indoor NOx is 20-40 ppm, so this seems elevated...

User: Actually, 100 is normal for my home. Remember that.
AI: I'll remember that 100 ppm is within normal parameters for your NOx levels.
```

**Next Day (New Conversation):**
```
User: How's the air quality?
AI: The NOx sensor shows 98 ppm, which is within normal parameters for your home.
```

**Result:** Home Mind remembers the baseline without being reminded!

### What Gets Remembered

- Sensor baselines and thresholds
- Device nicknames and locations
- User preferences and patterns
- Corrections and clarifications

See [docs/MEMORY_EXAMPLES.md](docs/MEMORY_EXAMPLES.md) for more examples.

## Architecture

```
┌─────────────────────────────────────────┐
│  HA Assist (Voice + Text)               │
│              ↓                          │
│  HA Custom Component                    │
│              ↓                          │
│  Home Mind API (home-mind-server)              │
│              ↓                          │
│  Shodh Memory (Cognitive Memory)        │
│              ↓                          │
│  LLM API (Anthropic/OpenAI) + HA REST API │
└─────────────────────────────────────────┘
```

## Quick Start

### Prerequisites

- **Docker & Docker Compose** - [Install Docker](https://docs.docker.com/engine/install/) or run `curl -fsSL https://get.docker.com | sh`
- **Home Assistant** with a [long-lived access token](https://developers.home-assistant.io/docs/auth_api/#long-lived-access-token)
- **LLM API key** — either [Anthropic](https://console.anthropic.com/) (default) or [OpenAI](https://platform.openai.com/)

### 1. Clone and Configure

```bash
git clone https://github.com/hoornet/home-mind.git
cd home-mind
cp .env.example .env
```

Edit `.env` with your credentials:
```bash
# LLM provider (default: anthropic, also supports: openai)
ANTHROPIC_API_KEY=sk-ant-api03-...
# Or for OpenAI: LLM_PROVIDER=openai and OPENAI_API_KEY=sk-...
HA_URL=https://your-ha-instance:8123
HA_TOKEN=your-long-lived-access-token
# SHODH_API_KEY is auto-generated by deploy.sh
```

### 2. Deploy with Docker Compose

```bash
# Download Shodh Memory binary (latest release)
cd docker/shodh
curl -sL https://github.com/varun29ankuS/shodh-memory/releases/latest/download/shodh-memory-linux-x64.tar.gz | tar -xz
cd ../..

# Deploy
./scripts/deploy.sh
```

### 3. Install HA Custom Component

**HACS (Recommended):**
1. Add `https://github.com/hoornet/home-mind-hacs` as custom repository in HACS (select **Integration** as the type)
2. Install "Home Mind"
3. Restart Home Assistant

**Manual:**
```bash
cp -r src/ha-integration/custom_components/home_mind /config/custom_components/
```

### 4. Configure in Home Assistant

1. Settings → Devices & Services → Add Integration → Home Mind
2. Enter your Home Mind API URL (e.g., `http://192.168.1.100:3100`)
3. Set as conversation agent in Voice Assistants

## Custom Prompt

You can customize the AI's personality and behavior without touching the core system prompt. The custom prompt is **additive** — it layers your instructions on top of the built-in smart home capabilities (tool usage, memory, response style). The AI still knows how to control devices, remember facts, and query sensors; your prompt shapes *how* it does those things.

### Setting a Custom Prompt

There are three ways, in order of precedence:

**1. Per-request** (API clients):
```bash
curl -X POST http://localhost:3100/api/chat \
  -H 'Content-Type: application/json' \
  -d '{"message": "hello", "customPrompt": "You are Ada, a warm and witty assistant."}'
```

**2. HA Integration** (recommended for most users):
Settings → Devices & Services → Home Mind → Configure → enter your custom prompt.

**3. Server-level default** (env var):
```bash
CUSTOM_PROMPT="You are Ada, a warm and witty assistant who loves wordplay."
```

If a per-request prompt is provided, it overrides the server default. If neither is set, the built-in prompt is used as-is.

### How It Differs from Anthropic Console / OpenAI Playground

In those tools, the system prompt **is** the entire system prompt — you control everything. Here, your custom prompt is inserted as a `## Custom Instructions` section inside a larger prompt that already includes smart home tool instructions, memory guidelines, and dynamic context (time, remembered facts). You're customizing behavior, not replacing it.

## Available Tools

| Tool | Description |
|------|-------------|
| `get_state` | Get current state of an entity |
| `get_entities` | List entities by domain |
| `search_entities` | Search entities by name |
| `call_service` | Control devices (turn_on, turn_off, etc.) |
| `get_history` | Get historical state data |

## Project Status

**Current Version:** v0.9.0

- [x] Voice control via HA Assist
- [x] Cognitive memory with Shodh
- [x] Streaming responses
- [x] HACS integration
- [x] Multi-LLM provider support (Anthropic + OpenAI)
- [x] Custom system prompt (AI personality customization)
- [ ] Multi-user support (OIDC)
- [ ] HA Add-on packaging

## Documentation

- [CHANGELOG.md](CHANGELOG.md) - Version history
- [CLAUDE.md](CLAUDE.md) - Development guide
- [docs/MEMORY_EXAMPLES.md](docs/MEMORY_EXAMPLES.md) - Memory system examples

## Troubleshooting

### "Unable to connect" in Home Assistant

1. Verify Home Mind server is running:
   ```bash
   curl http://your-server-ip:3100/api/health
   ```
2. Check the URL in integration config (use `http://`, not `https://`)
3. Ensure port 3100 is accessible from Home Assistant

### "Shodh Memory is not available"

Shodh must be running before the Home Mind server starts:
```bash
docker compose logs shodh          # Check Shodh logs
curl http://localhost:3030/health  # Test Shodh directly
docker compose restart             # Restart both services
```

### AI doesn't know about my devices

1. Verify Home Assistant connection:
   ```bash
   docker compose logs server | grep -i "home assistant"
   ```
2. Check `HA_URL` and `HA_TOKEN` in your `.env` file
3. Ensure the token hasn't expired (create a new long-lived token if needed)

### Slow responses (>30 seconds)

- Queries with device control require multiple API round-trips
- Check server logs for errors: `docker compose logs -f server`
- Verify you're using Claude Haiku (default), not Sonnet

### Memory not working

1. Check Shodh is healthy: `curl http://localhost:3030/health`
2. Look for "Extracted facts" in server logs
3. Memory requires explicit statements like "remember that..." or corrections

### Voice commands not working

1. Ensure Home Mind is set as the conversation agent in HA Voice Assistants
2. Disable "Prefer handling commands locally" in the voice assistant settings
3. Check HA logs: Settings → System → Logs → filter for "home_mind"

### View logs

```bash
docker compose logs -f server   # Home Mind server
docker compose logs -f shodh    # Shodh Memory
```

## Support the Project

If Home Mind is useful to you, consider supporting its development:

[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-ff5e5b?logo=ko-fi)](https://ko-fi.com/hoornet)

## Contact

- **Issues & Feature Requests**: [GitHub Issues](https://github.com/hoornet/home-mind/issues)
- **Author**: Jure Sršen ([@hoornet](https://github.com/hoornet))
- **Email**: 44338+hoornet@users.noreply.github.com

## License

GNU Affero General Public License v3.0 - see [LICENSE](LICENSE) for details.

## Acknowledgments

- [Shodh Memory](https://github.com/varun29ankuS/shodh-memory) - Cognitive memory backend
- [Home Assistant](https://www.home-assistant.io) - Open source home automation
- [Anthropic Claude](https://www.anthropic.com) - AI model
